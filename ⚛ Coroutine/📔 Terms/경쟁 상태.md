---
aliases:
  - Race Condition
  - Race Conditions
  - 레이스 컨디션
  - 경합 조건
importance: Medium
originated from:
  - "[[📘 코틀린 코루틴의 정석/11장 - 코루틴 심화]]"
  - "[[📘 코틀린 동시성 프로그래밍/1장 - Hello, Concurrent World!]]"
answered by:
  - OpenAI
  - "[[📘 코틀린 동시성 프로그래밍/1장 - Hello, Concurrent World!]]"
tags:
  - Coroutine
  - 코루틴
  - Terms
  - 주요_개념
learned:
---
##### ℹ️ Description
---
- [스레드](스레드.md) 또는 [코루틴](코루틴.md) 같은 여러 실행 흐름이 동시에 같은 자원([공유 상태](공유%20상태.md))에 접근하거나 수정할 때, 실행 순서에 따라 결과가 예상과 달라짐으로써 발생하는 문제

##### 🔥 How does it occur?
---
```Kotlin
fun main() = runBlocking {
    var count = 0
    val jobs = List(1_000) {
        launch(Dispatchers.Default) {
            repeat(1_000) {
                count++
            }
        }
	}
	
	jobs.joinAll()
	
	println("count: $count")
}
```
- [동기화](데이터%20동기화.md)없이 [가변 변수](가변%20변수.md)를 동시에 수정하면 발생
- [동시성](동시성.md) 코드가 항상 특정한 순서로 실행될 것이라 가정하고 오해할 때 발생

##### 🧯 How to handle?
---
- 경쟁 상태 문제는 하나의 가변 변수에 스레드가 동시에 접근할 수 없도록 만들어 해결
  ⋍ 정보에 접근하려고 하기 전에 정보를 얻을 때까지 명시적으로 기다림으로써 해결
- [Mutex](Mutex.md) 사용
```Kotlin
fun main() = runBlocking {
    var count = 0
    val mutex = Mutex()
    val jobs = List(1_000) {
        launch(context = Dispatchers.Default) {
            repeat(1_000) {
                mutex.withLock {
                    count++
                }
            }
		}
	}
	
    jobs.joinAll()
    
    println("count: $count")
}
```
- 원자적 자료 구조 사용
```Kotlin
fun main() = runBlocking {
    val count = AtomicInteger(0)
    val jobs = List(1_000) {
        launch(context = Dispatchers.Default) {
            repeat(1_000) {
                count.incrementAndGet()
            }
        }
	}
    
    jobs.joinAll()
    
    println("count: $count")
}
```
- [단일 스레드 디스패처](단일%20스레드%20디스패처.md) 사용
```Kotlin
fun main() = runBlocking {
    var count = 0
    val singleThreadDispatcher = Dispatchers.Default.limitedParallelism(1)
    val jobs = List(1_000) {
        launch(context = singleThreadDispatcher) {
            repeat(1_000) {
                count++
            }
        }
	}
    
    jobs.joinAll()
	
    println("count: $count")
}
```
