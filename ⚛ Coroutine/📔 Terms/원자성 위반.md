---
aliases:
  - Atomicity Violation
importance: Medium
originated from:
  - "[[ğŸ“˜ ì½”í‹€ë¦° ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°/1ì¥ - Hello, Concurrent World!]]"
answered by:
  - Book
  - GPT
tags:
  - Coroutine
  - ì½”ë£¨í‹´
  - Terms
  - ì£¼ìš”_ê°œë…
learned:
---
##### â„¹ï¸ Description
---
- ì—¬ëŸ¬ ê°œì˜ ì—°ì‚°ì„ í•˜ë‚˜ì˜ ë‹¨ìœ„ì²˜ëŸ¼ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë°, ë„ì¤‘ì— ë‹¤ë¥¸ [ìŠ¤ë ˆë“œ](ìŠ¤ë ˆë“œ.md)ë‚˜ [ì½”ë£¨í‹´](ì½”ë£¨í‹´.md) ê°™ì€ ì‹¤í–‰ íë¦„ì´ ë¼ì–´ë“¤ì–´ ê°’ì´ ì—‰í‚¤ëŠ” ë¬¸ì œ

##### ğŸ”¥ How does it occur?
---
```Kotlin
fun main() = runBlocking {
    val map = hashMapOf<Int, Boolean>()
    
    repeat(1_000) {
        launch(context = Dispatchers.Default) {
            if (!map.contains(it)) {
                map[it] = true
            }
        }
    }
    
    delay(1_000)
    
    println("count: ${list.count()}")
}
```
- ì—°ì‚°ì´ í•˜ë‚˜ì˜ ë‹¨ìœ„ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì„ ë•Œ ë°œìƒ

##### ğŸ§¯ How to handle?
---
- ìƒíƒœê°€ ë™ì‹œì— ìˆ˜ì •ë  ìˆ˜ ìˆì„ ë•Œ [ì›ìì„±](ì›ìì„±.md)ì´ í•„ìš”í•˜ë©°, ìƒíƒœì˜ ìˆ˜ì •ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ë³´ì¥í•´ì•¼ í•¨
- [Mutex](Mutex.md) ì‚¬ìš©
```Kotlin
fun main() = runBlocking {
    val map = hashMapOf<Int, Boolean>()
    val mutex = Mutex()
    
    repeat(1_000) {
        launch(context = Dispatchers.Default) {
            mutex.withLock {
                if (!map.contains(it)) {
                    map[it] = true
                }
            }
        }
	}
    delay(1_000)
    
    println("count: ${list.count()}")
}
```
- ì›ìì  ìë£Œ êµ¬ì¡° ì‚¬ìš©
```Kotlin
fun main() = runBlocking {
    val map = ConcurrentHashMap<Int, Boolean>()
    
    repeat(1_000) {
        launch(context = Dispatchers.Default) {
            map.putIfAbsent(it, true)
        }
    }
    delay(1_000)
    
    println("count: ${map.count()}")
}
```
